<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Firebase Test Login</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      font-family: "Tajawal";
      background:
        linear-gradient(to bottom, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.8)),
        url("https://i.postimg.cc/RVdVFtz0/hero.png") center/cover no-repeat;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
    }
    .card {
      width: 100%;
      max-width: 420px;
      background: rgba(0, 0, 0, 0.75);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(14px);
    }
    .input, .btn {
      width: 100%;
      padding: 0.9rem;
      margin-top: 0.8rem;
      border-radius: 0.6rem;
      border: none;
      font-size: 1rem;
    }
    .input {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid #555;
      color: #fff;
    }
    .btn {
      background: #f5deb3;
      color: #000;
      cursor: pointer;
    }
    .error { color: #ff7f7f; margin-top: 0.8rem; }
    .info  { color: #7fffb1; margin-top: 1rem; white-space: pre-line; }
  </style>
</head>
<body>

<div class="card">
  <h2 style="text-align:center;">ğŸ”¥ ØªØ¬Ø±Ø¨Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Firebase</h2>

  <input id="identifier" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„" />
  <input id="password" type="password" class="input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />

  <button id="loginBtn" class="btn">ØªØ¬Ø±Ø¨Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>

  <div id="errorBox" class="error"></div>
  <div id="infoBox" class="info"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  // Firebase setup
  const firebaseConfig = {
    apiKey: "AIzaSyDXQW3_6iFkb8Ec2aaVtFMJZYxLN-FmI54",
    authDomain: "ptw-najran-sharurah.firebaseapp.com",
    projectId: "ptw-najran-sharurah",
    storageBucket: "ptw-najran-sharurah.firebasestorage.app",
    messagingSenderId: "848619550286",
    appId: "1:848619550286:web:fe5c470f67236b2519751f"
  };

  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // Ù…Ø¨Ø§Ø±ÙŠØ§Øª ptw_users
  function readStoredUsers() {
    try {
      const raw = localStorage.getItem("ptw_users");
      if (!raw) return [];
      const list = JSON.parse(raw);
      return Array.isArray(list) ? list : [];
    } catch {
      return [];
    }
  }

  const btn       = document.getElementById("loginBtn");
  const idInput   = document.getElementById("identifier");
  const pwInput   = document.getElementById("password");
  const errorBox  = document.getElementById("errorBox");
  const infoBox   = document.getElementById("infoBox");

  btn.addEventListener("click", async () => {
    errorBox.textContent = "";
    infoBox.textContent = "";

    const identifier = idInput.value.trim();
    const password   = pwInput.value.trim();

    if (!identifier || !password) {
      errorBox.textContent = "Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©.";
      return;
    }

    let loginEmail = identifier;

    // username â†’ email
    if (!identifier.includes("@")) {
      const usersList = readStoredUsers();
      const userObj = usersList.find(u => u.username === identifier);

      if (!userObj || !userObj.email) {
        errorBox.textContent = "Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆØ²Ø± ØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨Ø¥ÙŠÙ…ÙŠÙ„. Ø¹Ø¯Ù‘Ù„Ù‡ Ù…Ù† ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.";
        return;
      }

      loginEmail = userObj.email;
    }

    try {
      const cred = await signInWithEmailAndPassword(auth, loginEmail, password);
      const user = cred.user;

      infoBox.textContent =
        "âœ”ï¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­\n" +
        "UID: " + user.uid + "\n" +
        "Email: " + user.email + "\n";
    } catch (err) {
      errorBox.textContent = "âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.";
      console.error(err);
    }
  });
</script>

</body>
</html>
