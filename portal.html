<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¨ÙˆØ§Ø¨Ø© ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ | Ø§Ù„Ù†Ø¬Ø§Ø± Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª</title>
  <meta name="description" content="Ø¥Ù†Ø´Ø§Ø¡ ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ ÙˆØ·Ø¨Ø§Ø¹ØªÙ‡Ø§ PDF Ø¨Ø³Ø±Ø¹Ø©.">
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="./manifest.webmanifest">

  <link rel="icon" href="./favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="./favicon.png">

  <meta property="og:type" content="website">
  <meta property="og:locale" content="ar_AR">
  <meta property="og:title" content="Ø¨ÙˆØ§Ø¨Ø© ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ | Ø§Ù„Ù†Ø¬Ø§Ø± Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª">
  <meta property="og:description" content="Ø¥Ù†Ø´Ø§Ø¡ ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ ÙˆØ·Ø¨Ø§Ø¹ØªÙ‡Ø§ PDF Ø¨Ø³Ø±Ø¹Ø©.">
  <meta property="og:image" content="./og-image.png">

  <style>
    :root{
      --card-bg: rgba(255,255,255,.07);
      --card-bg-hover: rgba(255,255,255,.10);
      --text:#fff; --muted:#d1d5db; --focus:#60a5fa;
      --accent-najran:#2563eb; --accent-sharurah:#16a34a;
      --panel: rgba(0,0,0,.35); --panel-brd: rgba(255,255,255,.16);
    }
    *{box-sizing:border-box}
    body{
      font-family:'Segoe UI',system-ui,Tahoma; margin:0; color:var(--text);
      background:#0f172a;
      padding:0 16px 110px;
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%, #000 100%);
    }
    .overlay{position:fixed;inset:0;backdrop-filter:blur(5px) brightness(.55);z-index:0}
    .container{
      position:relative;
      z-index:1;
      max-width:1100px;
      margin:auto;
      padding:40px 0 120px;
    }
    h1{margin:0 0 8px;font-size:2.4rem;text-align:center}
    .subtitle{color:#cbd5e1;text-align:center;margin:0 0 18px}

    /* ===== Ø´Ø±ÙŠØ· Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„ØµØºÙŠØ± ÙÙŠ Ø§Ù„ÙƒÙˆØ±Ù†Ø± ===== */
    /* ÙƒØ§Ø±Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ ÙÙŠ Ø§Ù„ÙƒÙˆØ±Ù†Ø± */
.user-bar{
  position:fixed;
  top:16px;
  inset-inline-end:18px;        /* ÙŠÙ…ÙŠÙ† ÙÙŠ RTL */
  z-index:40;

  width:280px;
  max-width:92vw;

  display:flex;
  flex-direction:column;
  align-items:flex-start;
  gap:8px;

  padding:12px 14px;
  border-radius:18px;
  background:rgba(15,23,42,.88);
  border:1px solid rgba(148,163,184,.70);
  box-shadow:0 22px 60px rgba(15,23,42,.90);
  backdrop-filter:blur(10px) saturate(130%);
  font-size:0.82rem;
  direction:rtl;
}

/* ØªÙŠÙƒØ³Øª Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
#welcomeUser{
  font-weight:600;
  color:#e5e7eb;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* ØµÙ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ØªØ­Øª Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
.user-actions-bar{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}

    #welcomeUser {
      font-weight:600;
      color:#e5e7eb;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    /* Ø²Ø±Ù‘Ø§Ø± ØµØºÙŠØ± ÙƒÙ€ chip */
.logout-btn{
  background:rgba(15,23,42,.92);
  border:1px solid rgba(148,163,184,.85);
  color:#e5e7eb;
  padding:5px 11px;
  border-radius:999px;
  cursor:pointer;
  font-weight:600;
  font-size:0.78rem;
  white-space:nowrap;
  display:inline-flex;
  align-items:center;
  gap:4px;
}
.logout-btn:hover{
  filter:brightness(1.06);
  transform:translateY(-1px);
}
.logout-btn:active{
  transform:translateY(0);
}

/* Ù„ÙˆÙ† Ø®Ø§Øµ Ù„Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ */
.logout-danger{
  background:rgba(127,29,29,.80);
  border-color:#fca5a5;
  color:#fee2e2;
}

    .soft-note{
      text-align:center; margin:12px auto 18px; max-width:980px;
      background:var(--panel); border:1px solid var(--panel-brd);
      padding:12px 14px; border-radius:12px; font-weight:700;
    }

    .seg{
      display:flex; gap:10px; justify-content:center; flex-wrap:wrap;
      background:rgba(15,23,42,.9); border:1px solid rgba(148,163,184,.5);
      border-radius:12px; padding:8px; margin:12px auto 16px; max-width:980px;
    }
    .seg button{
      position:relative; padding:12px 14px; border-radius:10px; border:1px solid transparent;
      background:transparent; color:var(--text); cursor:pointer; font-weight:700; font-size:0.95rem;
    }
    .seg button.active{
      background: radial-gradient(circle at top, rgba(96,165,250,.2), rgba(15,23,42,1));
      border-color:rgba(148,163,184,.8);
      box-shadow:0 0 0 1px rgba(148,163,184,.8);
    }
    .seg .badge-new{
      position:absolute; top:-8px; inset-inline-end:-8px;
      font-size:.7rem; background:#22c55e; color:#04101f; padding:3px 7px; border-radius:999px; border:1px solid #a7f3d0;
    }

    .toolbar{
      display:grid; align-items:center; gap:10px;
      grid-template-columns: 1fr auto;
      max-width:980px; margin:0 auto 14px;
    }
    .search{ display:flex; background:var(--panel); border:1px solid var(--panel-brd); border-radius:12px; padding:6px; }
    #searchInput{ flex:1; min-width:0; padding:10px 12px; border-radius:8px; border:none; background:rgba(255,255,255,.10); color:var(--text); text-align:right; }
    .user-actions-bar{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      margin-inline-start:auto;
    }

    .install-btn{
      background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.2); color:var(--text);
      padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700;
    }
    .install-btn:hover{ box-shadow:0 0 0 2px rgba(96,165,250,.25) inset }

    .section-title{max-width:980px;margin:22px auto 10px; font-size:1.1rem; border-bottom:1px solid #475569; padding-bottom:8px}
    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:18px; max-width:980px; margin:0 auto}
    .card{
      display:block; text-decoration:none; color:var(--text); text-align:right;
      background:var(--card-bg); border-radius:20px; padding:16px 18px; backdrop-filter:blur(6px);
      transition:.25s; border:1px solid rgba(148,163,184,.45); box-shadow:0 18px 45px rgba(15,23,42,.7);
    }
    .card:hover{ transform:translateY(-4px) scale(1.01); background:var(--card-bg-hover); box-shadow:0 26px 65px rgba(59,130,246,.6)}
    .card:focus{ outline:3px solid rgba(96,165,250,.6); outline-offset:2px }
    .top{display:flex; gap:10px; align-items:center; margin-bottom:6px}
    .title{font-weight:700}
    .badge{margin-inline-start:auto; font-size:.8rem; padding:4px 8px; border-radius:999px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.18)}
    .desc{color:var(--muted); font-size:.92rem}
    .skeleton{border-radius:12px;height:72px;background:rgba(255,255,255,0.08);position:relative;overflow:hidden}
    .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);background:linear-gradient(90deg,transparent,rgba(255,255,255,.18),transparent);animation:shimmer 1.2s infinite}
    @keyframes shimmer{100%{transform:translateX(100%)}}
    [hidden]{display:none !important}

    .tiny{ max-width:980px; margin:10px auto; color:#e5e7eb; text-align:right; background:rgba(15,23,42,.9); border:1px solid rgba(148,163,184,.7); padding:12px 14px; border-radius:12px; }
    footer{margin-top:36px; text-align:center; color:#a3a3a3}

    @media(max-width:900px){
      .toolbar{
        grid-template-columns: 1fr;
      }
    }
    @media(max-width:640px){
      h1{font-size:1.8rem}
      .subtitle{font-size:.9rem}
      .user-bar{
        top:8px;
        inset-inline:10px;
        max-width:none;
        justify-content:space-between;
        gap:6px;
        padding:6px 10px;
      }
      #welcomeUser{font-size:0.78rem;}
    }
    @media (prefers-reduced-motion: reduce){
      .card{ transition:none }
      .card:hover{ transform:none; box-shadow:0 6px 20px rgba(0,0,0,.18) }
      .skeleton::after{ animation:none }
    }

    .ic{ width:22px; height:22px; display:inline-block; vertical-align:-3px; color:inherit }
    .card .ic{ color:#93c5fd }
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}

    .card:focus-visible,
    .seg button:focus-visible,
    .install-btn:focus-visible,
    #reloadBtn:focus-visible,
    .logout-btn:focus-visible {
      outline:3px solid var(--focus); outline-offset:2px;
    }

    /* ===== Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†ÙˆÙŠÙ‡ Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø© (Ø´Ø±ÙˆØ±Ø© ÙÙ‚Ø·) ===== */
    .announce-bar{
      max-width:980px;
      margin: 58px auto 18px;
      padding:8px 14px;
      border-radius:999px;
      background: linear-gradient(90deg,#1d4ed8,#0f172a);
      border:1px solid rgba(191,219,254,.8);
      display:flex;
      align-items:center;
      gap:10px;
      box-shadow:0 12px 30px rgba(15,23,42,.7);
      position:relative;
      overflow:hidden;
      font-size:.9rem;
    }
    .announce-pill{
      background:rgba(248,250,252,.15);
      border-radius:999px;
      padding:4px 10px;
      border:1px solid rgba(191,219,254,.9);
      font-weight:700;
      white-space:nowrap;
    }
    .announce-track{
      flex:1;
      overflow:hidden;
    }
    .announce-text{
      white-space:nowrap;
      animation:announce-ticker 18s linear infinite;
    }
    @keyframes announce-ticker{
      0%{ transform:translateX(-100%); }
      100%{ transform:translateX(100%); }
    }
    .announce-close{
      background:transparent;
      border:none;
      color:#e5e7eb;
      font-size:1.1rem;
      cursor:pointer;
      padding:0 4px;
    }
    .announce-close:hover{
      color:#fca5a5;
    }

  </style>
</head>
<body>
  <div class="overlay"></div>
  <div class="container">

       <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙÙŠ Ø§Ù„ÙƒÙˆØ±Ù†Ø± -->
    <div class="user-bar">
      <span id="welcomeUser">ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ</span>
      <div class="user-actions-bar">
        <button id="btnProfile" class="logout-btn" type="button" style="background:rgba(15,23,42,.5);border-color:rgba(148,163,184,.9);color:#e5e7eb;">
          ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
        </button>
        <button id="btnAdminPanel" class="logout-btn" type="button" style="display:none;">
          âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        </button>
        <button id="btnActivity" class="logout-btn" type="button" style="display:none;">
          ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·
        </button>
        <button id="btnLogout" class="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      </div>
    </div>


    <h1>Ø¨ÙˆØ§Ø¨Ø© ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„</h1>
    <p class="subtitle">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØ§Ø¨Ø© ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø´Ø±ÙƒØ© Ø§Ù„Ù†Ø¬Ø§Ø± Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª</p>

    <!-- Ø´Ø±ÙŠØ· ØªÙ†ÙˆÙŠÙ‡ Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø© (ÙŠØ¸Ù‡Ø± ÙÙŠ Ù…Ø´Ø±ÙˆØ¹ Ø´Ø±ÙˆØ±Ø© ÙÙ‚Ø·) -->
    <div class="announce-bar" id="tbtNotice" hidden>
      <span class="announce-pill">ğŸ†• Ø¬Ø¯ÙŠØ¯</span>
      <div class="announce-track">
        <div class="announce-text">
          âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ„Ù‘Ø¯ Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø© (Toolbox Talk) ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© Ø¶Ù…Ù† Ù‚Ø³Ù… "Ù…ÙˆØ§Ø±Ø¯ Ø¥Ø¶Ø§ÙÙŠØ©" Ù„Ù…Ø´Ø±ÙˆØ¹ Ø´Ø±ÙˆØ±Ø©.
        </div>
      </div>
      <button class="announce-close" type="button" aria-label="Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†ÙˆÙŠÙ‡">Ã—</button>
    </div>

    <div class="soft-note">ğŸ§­ ÙŠÙØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div>

    <div class="seg" role="tablist" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">
      <button id="btn-najran" role="tab" aria-selected="true" class="active"
        data-project="najran" title="Ù…Ø¨Ù†Ù‰ Ø¥Ø¯Ø§Ø±ÙŠ ÙˆÙ…Ø¨Ù†Ù‰ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù…Ø­Ø·Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ù†Ø¬Ø±Ø§Ù†">
        Ù…Ø¨Ù†Ù‰ Ø¥Ø¯Ø§Ø±ÙŠ ÙˆÙ…Ø¨Ù†Ù‰ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù…Ø­Ø·Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ù†Ø¬Ø±Ø§Ù†
      </button>
      <button id="btn-sharurah" role="tab" aria-selected="false"
        data-project="sharurah" title="Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØ§Ø¨Ø§Øª Ø£Ù…Ù†ÙŠØ© Ø¨Ù…Ø­Ø·Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø´Ø±ÙˆØ±Ø©">
        Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØ§Ø¨Ø§Øª Ø£Ù…Ù†ÙŠØ© Ø¨Ù…Ø­Ø·Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø´Ø±ÙˆØ±Ø©
        <span class="badge-new">Ø¬Ø¯ÙŠØ¯</span>
      </button>
    </div>

    <div class="toolbar">
      <div class="search" role="search">
        <input id="searchInput" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ØªØµØ±ÙŠØ­ Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯ (â€¦ WAH-GWP â€¦)" oninput="filterPermits()" aria-label="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØªØµØ§Ø±ÙŠØ­">
      </div>
      <button id="btnInstall" class="install-btn" hidden>â¬‡ï¸ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
    </div>

    <div id="projTitle" class="section-title"></div>
    <div class="grid" id="skeleton"></div>
    <div class="grid" id="grid" aria-live="polite"></div>

    <div id="resourcesSection" class="section-title" hidden>ğŸ“‚ Ù…ÙˆØ§Ø±Ø¯ Ø¥Ø¶Ø§ÙÙŠØ©</div>
    <div id="resourcesGrid" class="grid" hidden></div>

    <footer>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Eng.Ahmed El-Basha</footer>
  </div>
 <!-- Ù…Ù„Ù Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ -->
  <script type="module" src="activity-log.js">
    
  </script>
  <script>
    // ===== Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© + Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… =====
    let CURRENT_USER = null;
    let ALLOWED_PROJECTS = ["najran", "sharurah"];
    let VIEW_ONLY_MODE = false; // Ù„Ù„Ø±ÙˆÙ„Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© viewer

    (function protectPortal() {
      try {
        const raw = localStorage.getItem("aln_session");
        if (!raw) {
          window.location.href = "/";
          return;
        }

        const session = JSON.parse(raw);
        if (!session || !session.username || !session.role) {
          localStorage.removeItem("aln_session");
          window.location.href = "/";
          return;
        }

        // ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù€ role: lowercase + Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¨Ù€ Underscore
        const rawRole = String(session.role || "")
          .trim()
          .toLowerCase();

        const normalizedRole = rawRole.replace(/\s+/g, "_");

        CURRENT_USER = {
          ...session,
          role: normalizedRole,   // Ù‡Ù†Ø§ Ø¨Ù†ØªØ¹Ø§Ù…Ù„ ÙÙŠ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© ÙƒÙ„Ù‡Ø§ Ø¨Ø§Ù„Ù€ normalized role
          _rawRole: rawRole       // Ù„Ù„Ø§Ø­ØªÙŠØ§Ø· Ù„Ùˆ Ø­Ø¨ÙŠØª ØªØ³ØªØ®Ø¯Ù…Ù‡ Ø¨Ø¹Ø¯ÙŠÙ†
        };

        const role = normalizedRole;

        if (role === "najran") {
          ALLOWED_PROJECTS = ["najran"];
        } else if (role === "sharurah") {
          ALLOWED_PROJECTS = ["sharurah"];
        } else if (role === "najran_viewer") {
          ALLOWED_PROJECTS = ["najran"];
          window.location.href = '/portal-viewer.html';
          return;
          VIEW_ONLY_MODE = true;
        } else if (role === "sharurah_viewer") {
          ALLOWED_PROJECTS = ["sharurah"];
          window.location.href = '/portal-viewer.html';
          return;
          VIEW_ONLY_MODE = true;
          
        } else {
          // admin Ø£Ùˆ Ø£ÙŠ Ø±ÙˆÙ„ Ø¹Ø§Ù…
          ALLOWED_PROJECTS = ["najran", "sharurah"];
        }
      } catch (e) {
        console.error(e);
        window.location.href = "/";
      }
    })();

    // ===== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =====
    const PROJECTS = {
      najran: {
        id:'najran',
        name:'Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ù…ØªØ§Ø­Ø© â€” Ù…Ø¨Ù†Ù‰ Ø¥Ø¯Ø§Ø±ÙŠ ÙˆÙ…Ø¨Ù†Ù‰ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù…Ø­Ø·Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ù†Ø¬Ø±Ø§Ù†',
        links:[
          { title:"ØªØµØ±ÙŠØ­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¹Ø§Ù…Ø©",            code:"GWP", icon:"gwp", desc:"Ø£Ø¹Ù…Ø§Ù„ Ø¹Ø§Ù…Ø© Ù„Ø§ ØªÙ†Ø¯Ø±Ø¬ ØªØ­Øª ØªØµØ§Ø±ÙŠØ­ Ù…ØªØ®ØµØµØ©.",                 url:"https://ptw-ung.pages.dev/" },
          { title:"ØªØµØ±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù…Ø±ØªÙØ¹Ø©", code:"WAH", icon:"wah", desc:"Ø£Ø¹Ù…Ø§Ù„ ÙÙˆÙ‚ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø±Ø¶ ØªØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙˆÙ‚Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø³Ù‚ÙˆØ·.",            url:"https://wah-8vl.pages.dev/" },
          { title:"ØªØµØ±ÙŠØ­ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø­ÙØ±",               code:"EXC", icon:"exc", desc:"Ø£Ø¹Ù…Ø§Ù„ Ø­ÙØ±/Ø®Ù†Ø§Ø¯Ù‚ ÙˆÙ…Ø¬Ø§ÙˆØ±Ø© Ø®Ø¯Ù…Ø§Øª Ù…Ø¯ÙÙˆÙ†Ø©.",                   url:"https://exc-ewd.pages.dev/" },
          { title:"ØªØµØ±ÙŠØ­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø³Ø§Ø®Ù†Ø©",           code:"HWP", icon:"hwp", desc:"Ù„Ø­Ø§Ù…/Ù‚Ø·Ø¹/Ø¬Ø±Ø§ÙŠÙ†Ø¯Ø± Ø£Ùˆ Ø£ÙŠ Ù…ØµØ¯Ø± Ø´Ø±Ø±/Ù„Ù‡Ø¨.",                    url:"https://hwp-4gj.pages.dev/" },
          { title:"ØªØµØ±ÙŠØ­ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù…Ø­ØµÙˆØ±Ø©",          code:"CSE", icon:"cse", desc:"Ø¯Ø®ÙˆÙ„ Ù…Ù†Ø§Ø·Ù‚ Ù…ØºÙ„Ù‚Ø© Ø§Ù„ØªÙ‡ÙˆÙŠØ© Ø£Ùˆ Ø°Ø§Øª ÙØªØ­Ø§Øª Ù…Ø­Ø¯ÙˆØ¯Ø©.",               url:"https://cse-4u5.pages.dev/" },
          { title:"ØªØµØ±ÙŠØ­ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø±ÙØ¹",               code:"LOP", icon:"lop", desc:"Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£ÙˆÙ†Ø§Ø´ ÙˆØ§Ù„Ø±ÙØ¹ Ø¨Ø§Ù„Ø±Ø§ÙØ¹Ø§Øª ÙˆØ§Ù„ÙˆÙ†Ø´Ø§Øª.",                  url:"https://lop-555.pages.dev/" }
        ],
        resources:[
          { label:"Ø¬Ø§Ù„Ø±ÙŠ ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„", code:"LOG", icon:"log", desc:"Ø¹Ø±Ø¶ ÙˆØªØªØ¨Ø¹ Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„ØµØ§Ø¯Ø±Ø©.", href:"https://gwp-gallery.pages.dev/" },
          { label:"ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±",    code:"RA",  icon:"ra",  desc:"Ù†Ù…Ø§Ø°Ø¬ ÙˆØ¥Ø±Ø´Ø§Ø¯Ø§Øª ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±.", href:"https://sites.google.com/view/najran-ra/home" }
        ]
      },
      sharurah: {
        id:'sharurah',
        name:'Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ù…ØªØ§Ø­Ø© â€” Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØ§Ø¨Ø§Øª Ø£Ù…Ù†ÙŠØ© Ø¨Ù…Ø­Ø·Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø´Ø±ÙˆØ±Ø©',
        links:[
          { title:"ØªØµØ±ÙŠØ­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¹Ø§Ù…Ø©",            code:"GWP", icon:"gwp", desc:"Ø£Ø¹Ù…Ø§Ù„ Ø¹Ø§Ù…Ø© Ù„Ø§ ØªÙ†Ø¯Ø±Ø¬ ØªØ­Øª ØªØµØ§Ø±ÙŠØ­ Ù…ØªØ®ØµØµØ©.",                 url:"https://sharura-gwp.pages.dev/" },
          { title:"ØªØµØ±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù…Ø±ØªÙØ¹Ø©", code:"WAH", icon:"wah", desc:"Ø£Ø¹Ù…Ø§Ù„ ÙÙˆÙ‚ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø±Ø¶ ØªØªØ·Ù„Ø¨ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙˆÙ‚Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø³Ù‚ÙˆØ·.",           url:"https://sharura-wah.pages.dev/" },
          { title:"ØªØµØ±ÙŠØ­ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø­ÙØ±",               code:"EXC", icon:"exc", desc:"Ø£Ø¹Ù…Ø§Ù„ Ø­ÙØ±/Ø®Ù†Ø§Ø¯Ù‚ ÙˆÙ…Ø¬Ø§ÙˆØ±Ø© Ø®Ø¯Ù…Ø§Øª Ù…Ø¯ÙÙˆÙ†Ø©.",                  url:"https://sharura-exc.pages.dev/" },
          { title:"ØªØµØ±ÙŠØ­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø³Ø§Ø®Ù†Ø©",           code:"HWP", icon:"hwp", desc:"Ù„Ø­Ø§Ù…/Ù‚Ø·Ø¹/Ø¬Ø±Ø§ÙŠÙ†Ø¯Ø± Ø£Ùˆ Ø£ÙŠ Ù…ØµØ¯Ø± Ø´Ø±Ø±/Ù„Ù‡Ø¨.",                   url:"https://sharura-hwp.pages.dev/" },
          { title:"ØªØµØ±ÙŠØ­ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù…Ø­ØµÙˆØ±Ø©",          code:"CSE", icon:"cse", desc:"Ø¯Ø®ÙˆÙ„ Ù…Ù†Ø§Ø·Ù‚ Ù…ØºÙ„Ù‚Ø© Ø§Ù„ØªÙ‡ÙˆÙŠØ© Ø£Ùˆ Ø°Ø§Øª ÙØªØ­Ø§Øª Ù…Ø­Ø¯ÙˆØ¯Ø©.",              url:"https://sharura-cse.pages.dev/" },
          { title:"ØªØµØ±ÙŠØ­ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø±ÙØ¹",               code:"LOP", icon:"lop", desc:"Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£ÙˆÙ†Ø§Ø´ ÙˆØ§Ù„Ø±ÙØ¹ Ø¨Ø§Ù„Ø±Ø§ÙØ¹Ø§Øª ÙˆØ§Ù„ÙˆÙ†Ø´Ø§Øª.",                  url:"https://sharura-lop.pages.dev/" }
        ],
        resources:[
          { label:"Ø¬Ø§Ù„Ø±ÙŠ ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„", code:"LOG", icon:"log", desc:"Ø¹Ø±Ø¶ ÙˆØªØªØ¨Ø¹ Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„ØµØ§Ø¯Ø±Ø©.", href:"https://sharura-gallery.pages.dev/" },
          { label:"Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©", code:"TBT", icon:"tbt", desc:"Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ·Ø¨Ø§Ø¹Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø© (Toolbox Talk).", href:"https://sharura-tbt.pages.dev/" },
          { label:"ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± ", code:"RA", icon:"ra", desc:"Ù†Ù…Ø§Ø°Ø¬ ÙˆØ¥Ø±Ø´Ø§Ø¯Ø§Øª ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù„Ù…Ø´Ø±ÙˆØ¹ Ø´Ø±ÙˆØ±Ø©.", href:"https://sites.google.com/d/1GcTU71M0DlHm8LBQZ_osejInCnqfdOUq/p/1CslJgVDImOo_PSOLHpDuvoe2HfdpIUfF/edit" }
        ]
      }
    };

      // ===== Ø³Ø¬Ù„ Ù†Ø´Ø§Ø· Ù…Ø±ÙƒØ²ÙŠ (Firestore Ø¹Ù† Ø·Ø±ÙŠÙ‚ activity-log.js) Ù…Ø¹ fallback Ù…Ø­Ù„ÙŠ =====
    async function logAction(type, details) {
      try {
        // Ù„Ùˆ Ù…Ù„Ù activity-log.js Ù…Ø­Ù…Ù‘Ù„ â†’ Ù†Ø³Ø¬Ù‘Ù„ ÙÙŠ Firestore
        if (window.logActivity) {
          await window.logActivity(type, details || {});
          return;
        }

        // Ù„Ùˆ Ù„Ø£ÙŠ Ø³Ø¨Ø¨ Ù…Ø´ Ù…ØªØ§Ø­ â†’ Ù†Ø±Ø¬Ø¹ Ù„Ù„Ù€ localStorage ÙƒÙ€ Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        const key = "ptw_activity_log";
        const raw = localStorage.getItem(key);
        let list = [];
        if (raw) {
          try { list = JSON.parse(raw) || []; } catch (_) { list = []; }
        }

        list.push({
          user: CURRENT_USER ? CURRENT_USER.username : null,
          role: CURRENT_USER ? CURRENT_USER.role : null,
          type,
          details: details || null,
          time: new Date().toISOString()
        });

        if (list.length > 100) {
          list = list.slice(-100);
        }

        localStorage.setItem(key, JSON.stringify(list));
      } catch (e) {
        console.error("logAction error", e);
      }
    }


    // ===== DOM =====
    const grid = document.getElementById('grid');
    const skeleton = document.getElementById('skeleton');
    const projTitle = document.getElementById('projTitle');
    const seg = document.querySelector('.seg');
    const resourcesSection = document.getElementById('resourcesSection');
    const resourcesGrid = document.getElementById('resourcesGrid');
    const segNajranBtn = document.getElementById('btn-najran');
    const segSharurahBtn = document.getElementById('btn-sharurah');
    const welcomeUser = document.getElementById('welcomeUser');
    const btnLogout = document.getElementById('btnLogout');
    const tbtNotice = document.getElementById('tbtNotice');
    const announceCloseBtn = document.querySelector('.announce-close');

    // ===== Helpers =====
    function getParam(name){ const u=new URL(location.href); return u.searchParams.get(name) }
    function setParam(name,val){ const u=new URL(location.href); if(val==null){u.searchParams.delete(name)} else {u.searchParams.set(name,val)} history.replaceState({}, "", u.toString()); }
    function renderSkeletons(n=6){ skeleton.innerHTML=""; for(let i=0;i<n;i++){ const d=document.createElement('div'); d.className='skeleton'; skeleton.appendChild(d) } }

    function applyRoleVisibility(){
      if (ALLOWED_PROJECTS.length === 1) {
        const only = ALLOWED_PROJECTS[0];
        if (only === "najran" && segSharurahBtn) {
          segSharurahBtn.style.display = "none";
        } else if (only === "sharurah" && segNajranBtn) {
          segNajranBtn.style.display = "none";
        }
      }
    }

    function createCard({title, code, icon, desc, url}){
      const a=document.createElement('a'); a.className='card'; a.href=url; a.target="_blank"; a.rel="noopener";
      a.setAttribute('data-title', (title+' '+code).toLowerCase());
      const known=['wah','hwp','exc','cse','gwp','lop','log','ra','tbt'];
      const iconHtml = known.includes((icon||'').toLowerCase())
        ? `<svg class="ic" aria-hidden="true"><use href="#icon-${icon.toLowerCase()}"/></svg>`
        : `<span>${icon||''}</span>`;

      a.innerHTML=`
        <div class="top">
          <span>${iconHtml}</span>
          <span class="title">${title}</span>
          <span class="badge">${code}</span>
        </div>
        <div class="desc">${desc}</div>
        <div class="actions" style="margin-top:10px;display:flex;gap:8px">
          <button class="copy" type="button"
            style="padding:6px 10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);border-radius:8px;color:#fff;cursor:pointer">
            Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
          </button>
        </div>
      `;

      a.querySelector('.copy').addEventListener('click', async (ev) => {
        ev.preventDefault(); ev.stopPropagation();
        const shareUrl = new URL(a.href);
        shareUrl.searchParams.set('utm_source','ptw');
        shareUrl.searchParams.set('utm_campaign', code);
        try{
          await navigator.clipboard.writeText(shareUrl.toString());
          a.querySelector('.copy').textContent = 'âœ” ØªÙ… Ø§Ù„Ù†Ø³Ø®';
          setTimeout(()=> a.querySelector('.copy').textContent = 'Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·', 1600);
        }catch(_){}
      });

      a.addEventListener('click', async (e)=>{
        logAction("open_permit", { title, code, url });

        try{
          await fetch(url, { method:'HEAD', mode:'no-cors' });
        }catch(_){
          e.preventDefault();
          const t=document.getElementById('linkToast'); if(t){ t.style.display='inline-block'; setTimeout(()=>t.style.display='none',2200); }
        }
      });

      return a;
    }

   function createResCard({label, code, icon, desc, href}){
  const a = document.createElement('a');
  a.className = 'card';
  a.href = href;
  a.target = '_blank';
  a.rel = 'noopener';

  const known = ['wah','hwp','exc','cse','gwp','lop','log','ra','tbt'];
  const iconHtml = known.includes((icon || '').toLowerCase())
    ? `<svg class="ic" aria-hidden="true"><use href="#icon-${icon.toLowerCase()}"/></svg>`
    : `<span>${icon || ''}</span>`;

  a.innerHTML = `
    <div class="top">
      <span>${iconHtml}</span>
      <span class="title">${label}</span>
      <span class="badge">${code}</span>
    </div>
    <div class="desc">${desc}</div>
  `;

  // âœ… ØªØ³Ø¬ÙŠÙ„ ÙØªØ­ Ø£ÙŠ Ù…ÙˆØ±Ø¯ Ø¥Ø¶Ø§ÙÙŠ (LOG / RA / TBT ...)
  a.addEventListener('click', () => {
    logAction("OPEN_RESOURCE", {
      label,
      code,
      href
    });
  });

  return a;
}


    function applyActive(projectId){
      document.querySelectorAll('.seg button').forEach(b=>{
        const active = b.dataset.project===projectId;
        b.classList.toggle('active', active);
        b.setAttribute('aria-selected', active ? 'true':'false');
      });
    }

    function renderProject(id){
      if (!ALLOWED_PROJECTS.includes(id)) {
        id = ALLOWED_PROJECTS[0] || "najran";
      }

      const p = PROJECTS[id] || PROJECTS.najran;

      // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ØªÙ†ÙˆÙŠÙ‡ Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
      if (tbtNotice) {
        const role = (CURRENT_USER?.role || "").toLowerCase();
        const showTbtNotice = (id === 'sharurah' && role !== 'sharurah_viewer');
        tbtNotice.hidden = !showTbtNotice;
      }

      projTitle.textContent = p.name;
      grid.innerHTML = "";
      skeleton.innerHTML = "";

      // ---- ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¯Ø§ØªØ§ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙˆØ± ----
      let linksToRender = p.links || [];
      let resourcesToRender = p.resources || [];

      const role = (CURRENT_USER?.role || "").toLowerCase();
      if (VIEW_ONLY_MODE) {
        // viewer â†’ Ù…ÙÙŠØ´ generators Ø®Ø§Ù„Øµ
        linksToRender = [];

        // Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ù†Ø³ÙŠØ¨ Ø¨Ø³ LOG + RA
        resourcesToRender = (resourcesToRender || []).filter(r => {
          const code = (r.code || "").toUpperCase();
          return code === "LOG" || code === "RA";
        });
      }

      // ---- Ø¹Ø±Ø¶ Ø§Ù„ØªØµØ§Ø±ÙŠØ­ (Ù„Ùˆ ÙÙŠÙ‡) ----
      if (linksToRender.length) {
        renderSkeletons(linksToRender.length);
        linksToRender.forEach(l=> grid.appendChild(createCard(l)));
        skeleton.innerHTML="";
      }

      // ---- Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© ----
      if (resourcesToRender && resourcesToRender.length){
        resourcesSection.hidden = false;
        resourcesGrid.hidden = false;
        resourcesGrid.innerHTML = "";
        resourcesToRender.forEach(r=> resourcesGrid.appendChild(createResCard(r)));
      } else {
        resourcesSection.hidden = true;
        resourcesGrid.hidden = true;
        resourcesGrid.innerHTML = "";
      }

      applyActive(p.id);
      setParam('project', p.id);
      localStorage.setItem('preferredProject', p.id);
      document.title = `Ø¨ÙˆØ§Ø¨Ø© ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ | ${p.name.replace('Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ù…ØªØ§Ø­Ø© â€” ','')}`;
      filterPermits();
    }

    function filterPermits(){
      const val=(document.getElementById('searchInput').value||'').toLowerCase().trim();
      grid.querySelectorAll('.card').forEach(c=>{
        const t=(c.getAttribute('data-title')||'').toLowerCase();
        c.style.display = !val || t.includes(val) ? '' : 'none';
      });
    }
    window.filterPermits = filterPermits;

    window.addEventListener('keydown', e=>{
      if(e.key==='/' && !/input|textarea/i.test(document.activeElement.tagName)){
        e.preventDefault(); document.getElementById('searchInput').focus();
      }
    });

    seg.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-project]');
      if (!btn) return;

      const projId = btn.dataset.project;
      if (!ALLOWED_PROJECTS.includes(projId)) return;

      const currentProj =
        getParam('project') ||
        localStorage.getItem('preferredProject') ||
        'najran';

      if (projId !== currentProj) {
        logAction("switch_project", { from: currentProj, to: projId });
      }

      renderProject(projId);
    });

    btnLogout?.addEventListener('click', () => {
      logAction("logout", {
        username: CURRENT_USER ? CURRENT_USER.username : null
      });

      localStorage.removeItem('aln_session');
      window.location.href = '/';
    });

    // Ø¥ØºÙ„Ø§Ù‚ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†ÙˆÙŠÙ‡
    announceCloseBtn?.addEventListener('click', () => {
      tbtNotice?.setAttribute('hidden','');
    });

    (function init(){
      applyRoleVisibility();

           if (CURRENT_USER && welcomeUser) {
        welcomeUser.textContent = `ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ ${CURRENT_USER.username} â€” ÙŠÙˆÙ… Ø¬Ù…ÙŠÙ„ Ø¹Ù„ÙŠÙƒ`;
      }

      const btnProfile   = document.getElementById('btnProfile');
      const btnAdminPanel= document.getElementById('btnAdminPanel');
      const btnActivity  = document.getElementById('btnActivity');

      btnProfile?.addEventListener('click', () => {
        window.location.href = '/profile.html';
      });

      if ((CURRENT_USER.role || '').toLowerCase() === 'admin') {
        if (btnAdminPanel) btnAdminPanel.style.display = 'inline-flex';
        if (btnActivity)   btnActivity.style.display   = 'inline-flex';

        btnAdminPanel?.addEventListener('click', () => {
          window.location.href = '/users.html';
        });
        btnActivity?.addEventListener('click', () => {
          window.location.href = '/activity.html';
        });
      }


      const saved = localStorage.getItem('preferredProject');
      let first = getParam('project') || saved || 'najran';
      if (!ALLOWED_PROJECTS.includes(first)) {
        first = ALLOWED_PROJECTS[0] || 'najran';
      }

           renderProject(first);

      // Ø³Ø¬Ù„ ÙØªØ­ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·
      logAction("PORTAL_OPEN", {
        project: first
      });

      const q = getParam('q');
      if(q){ const si=document.getElementById('searchInput'); si.value=q; filterPermits(); }

      const img = new Image();
      img.onload = ()=> document.body.style.background = "#0f172a url('https://i.postimg.cc/RVdVFtz0/hero.png') no-repeat center/cover fixed";
      img.src = 'https://i.postimg.cc/RVdVFtz0/hero.png';
    })();


    // ==== PWA Install Button ====
    let deferredPrompt = null;
    const btnInstall = document.getElementById('btnInstall');
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault(); deferredPrompt = e; btnInstall && (btnInstall.hidden = false);
    });
    btnInstall?.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null; btnInstall.hidden = true;
    });
    window.addEventListener('appinstalled', () => btnInstall?.setAttribute('hidden',''));

  </script>

  <!-- ===== SVG ICONS SPRITE (Ù…Ø®ÙÙŠ) ===== -->
  <svg xmlns="http://www.w3.org/2000/svg" style="position:absolute;width:0;height:0;overflow:hidden" aria-hidden="true">
    <symbol id="icon-wah" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M8 3v18M14 3v18M8 7h6M8 11h6M8 15h6" />
      <path d="M18 10l2-2 2 2" />
      <path d="M20 20v-10" />
    </symbol>
    <symbol id="icon-hwp" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 3c2.5 3 1 4.5 0 6s-1 2.5 0 4c1 1.6 3 2 4.5.6C18 12.8 18 10 16 7c0 4-3 3-3 1 0-1.5.5-2.5-1-5z"/>
      <path d="M8 14c-1.5 2.2-.3 5 2.5 6s6-.6 6.5-3.5"/>
    </symbol>
    <symbol id="icon-exc" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 17c1.5 1 3 1.5 5 1.5 2 0 3.5-.5 5-1.5" />
      <path d="M12 5l7 7" />
      <path d="M18 4l2 2-4 4-2-2z" />
      <path d="M9 12l3-3" />
    </symbol>
    <symbol id="icon-cse" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <ellipse cx="12" cy="7" rx="6" ry="3"/>
      <path d="M6 7v10c0 1.7 2.7 3 6 3s6-1.3 6-3V7" />
      <path d="M10 12l2 2 2-2M12 10v4" />
    </symbol>
    <symbol id="icon-gwp" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="6" y="5" width="12" height="14" rx="2" />
      <path d="M9 5.5V4h6v1.5" />
      <path d="M9 10h6M9 14h6" />
    </symbol>
    <symbol id="icon-lop" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 3v4a3 3 0 1 0 6 0V3" />
      <path d="M15 10v4a3 3 0 1 1-6 0" />
      <path d="M12 14c0 1.1-.9 2-2 2" />
    </symbol>
    <symbol id="icon-log" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M5 4h10a3 3 0 0 1 3 3v13H8a3 3 0 0 1-3-3z" />
      <path d="M5 8h13" />
      <path d="M9 12h6M9 16h6" />
    </symbol>
    <symbol id="icon-ra" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 3l7 3v5c0 5-3.5 8-7 10-3.5-2-7-5-7-10V6z" />
      <path d="M12 8v5" />
      <path d="M12 16h.01" />
    </symbol>
    <symbol id="icon-tbt" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="8" cy="9" r="3" />
      <path d="M5 16v-1a3 3 0 0 1 3-3h0a3 3 0 0 1 3 3v1" />
      <rect x="13" y="5" width="7" height="5" rx="1" />
      <path d="M16 15h4l-2 3z" />
    </symbol>
  </svg>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(()=>{});
      });
    }
  </script>

  <div id="updateToast" style="position:fixed; inset-inline:16px; bottom:16px; background:rgba(0,0,0,.75); color:#fff; padding:10px 14px; border-radius:10px; display:none; z-index:9999">
    ğŸ”„ ØªÙˆØ¬Ø¯ Ù†Ø³Ø®Ø© Ø£Ø­Ø¯Ø« Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.
    <button id="reloadBtn" style="margin-inline-start:10px; padding:6px 10px; border-radius:8px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.12); color:#fff; cursor:pointer">
      Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
    </button>
  </div>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        const t = document.getElementById('updateToast'); if (t) t.style.display='inline-block';
      });
      document.getElementById('reloadBtn')?.addEventListener('click', () => location.reload());
    }
  </script>

  <div id="linkToast" style="position:fixed;inset-inline:16px;bottom:16px;background:rgba(0,0,0,.8);color:#fff;padding:10px 14px;border-radius:10px;display:none;z-index:9999">
    âš ï¸ Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠÙ‹Ø§. Ø¬Ø±Ù‘Ø¨ Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„.
  </div>
</body>
</html>
